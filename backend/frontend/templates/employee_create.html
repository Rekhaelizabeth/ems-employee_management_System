<!doctype html><html><body>
<h2>Create Employee</h2>
<select id="template"></select>
<form id="empForm"></form>
<button id="save">Save Employee</button>

<script src="../static/app.js"></script>
<script>
async function loadTemplates(){
  const t = await api("/forms/");
  template.innerHTML = t.results ? "" : "";
  (t.results||t).forEach(ft => {
    const opt = document.createElement("option");
    opt.value = ft.id; opt.textContent = ft.name;
    template.appendChild(opt);
  });
  renderForm();
}
template.onchange = renderForm;

async function renderForm(){
  const id = template.value; if(!id) return;
  const ft = await api(`/forms/${id}/`);
  empForm.innerHTML = "";
  ft.fields.forEach(f=>{
    const d = document.createElement("div");
    d.innerHTML = `<label>${f.label}</label>
      <input data-fieldid="${f.id}" type="${f.field_type==='password'?'password':f.field_type==='date'?'date':f.field_type==='number'?'number':(f.field_type==='email'?'email':'text')}" ${f.required?'required':''}>`;
    empForm.appendChild(d);
  });
}
document.getElementById("save").onclick = async ()=>{
  const id = template.value;
  const inputs = [...empForm.querySelectorAll("input")];
  const values = inputs.map(inp=>({field: parseInt(inp.dataset.fieldid), value: inp.value}));
  await api("/employees/", {method:"POST", body:{template: parseInt(id), values}});
  alert("Employee created");
  empForm.reset();
};
loadTemplates();
</script></body></html>
