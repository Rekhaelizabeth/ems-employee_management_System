<!doctype html><html><body>
<h2>Create Form Template</h2>
<input id="form_name" placeholder="Form name">
<textarea id="form_desc" placeholder="Description"></textarea>
<div id="fields"></div>
<button id="add">Add Field</button>
<button id="save">Save Template</button>

<script src="../static/app.js"></script>
<script>
const fieldsDiv = document.getElementById("fields");
document.getElementById("add").onclick = () => addField();
function addField(label="", type="text", required=false){
  const idx = fieldsDiv.children.length;
  const row = document.createElement("div"); row.draggable = true; row.className="row";
  row.innerHTML = `
    <input class="label" placeholder="Label" value="${label}">
    <select class="type">
      <option>text</option><option>number</option><option>date</option>
      <option>password</option><option>email</option>
    </select>
    <label><input class="req" type="checkbox" ${required?"checked":""}> required</label>
    <button class="del">x</button>
  `;
  row.querySelector(".type").value = type;
  row.querySelector(".del").onclick = () => row.remove();

  // simple drag & drop
  row.addEventListener("dragstart", e => row.classList.add("drag"));
  row.addEventListener("dragend", e => row.classList.remove("drag"));
  fieldsDiv.addEventListener("dragover", e => {
    e.preventDefault();
    const dragging = document.querySelector(".drag");
    const after = [...fieldsDiv.querySelectorAll(".row")].find(r => e.clientY <= r.getBoundingClientRect().top + r.offsetHeight/2);
    after ? fieldsDiv.insertBefore(dragging, after) : fieldsDiv.appendChild(dragging);
  });

  fieldsDiv.appendChild(row);
}
document.getElementById("save").onclick = async () => {
  const name = form_name.value.trim();
  const description = form_desc.value.trim();
  const payload = { name, description, fields: [] };
  [...fieldsDiv.children].forEach((row, i) => {
    payload.fields.push({
      label: row.querySelector(".label").value,
      field_type: row.querySelector(".type").value,
      required: row.querySelector(".req").checked,
      order: i
    });
  });
  await api("/forms/", {method:"POST", body:payload});
  alert("Template saved");
};
</script></body></html>
